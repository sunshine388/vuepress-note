---
title: （一）源码环境搭建
---

手写 vue2 源码的初始环境搭建

<!-- more -->

# 使用 Rollup 构建 Vue2 环境

## 工程初始化

新建文件夹，执行 npm init -y 生成 package.json 文件

```js
npm init -y
```

## 安装 Rollup 打包依赖

```js
// 安装 rollup 打包用
npm install rollup -D
// 低级语法转高级语法（使用 babel 需安装@babel/core核心模块）
npm install @babel/core -D
// rollup 与 babel关联
npm install rollup-plugin-babel -D
// 将 ES6 转译为 ES5
npm install @babel/preset-env -D

// 实现 node 方式解析文件，不需要指定index
npm install @rollup/plugin-node-resolve -D
npm install babel-eslint -D
// 设置环境变量
npm install cross-env -D
// 实现静态服务
npm install rollup-plugin-serve -D
```

## 编写 Vue.js 入口文件

打包入口 src/index.js

```js
function Vue() {

}

export default Vue;
```

## 编写 Rollup 配置文件

创建 babel 配置文件.babelrc，创建 eslint 配置文件.eslintrc.js
创建文件 rollup.config.js

```js
// rollup.config.js
import babel from "rollup-plugin-babel";
import serve from "rollup-plugin-serve";
import resolve from "@rollup/plugin-node-resolve"; // 引入插件

export default {
  input: "./src/index.js", // 入口文件
  output: {
    format: "umd", // 支持amd 和 commonjs规范
    name: "Vue",
    file: "dist/vue.js", // 输出文件
    sourcemap: true,
  },
  plugins: [
    resolve(), // 使用插件
    babel({
      // 使用babel进行转化，但是排除node_modules文件
      exclude: "node_modules/**", // glob 语法；**表示任意文件
    }),
    // dev环境下在3000端口开启一个服务
    process.env.ENV === "development"
      ? serve({
          open: true,
          openPage: "/public/index.html",
          port: 3000,
          contentBase: "",
        })
      : null,
  ],
};
```

## 创建 rollup-script 构建脚本

修改 package.json 文件

```js
"scripts": {
  "serve": "cross-env ENV=development rollup -c -w",
  "build:dev": "rollup -c"
},
```

## 创建 Html 使用 Vue.js

dist 目录中创建页面入口：index.html

```js
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script src="/dist/vue.js"></script>
  <script>
    console.log(Vue)
  </script>
</body>
</html>
```

## 执行构建脚本

```js
npm run serve
```

在 dist 文件夹下生成 vue.js，vue.map.js 文件
