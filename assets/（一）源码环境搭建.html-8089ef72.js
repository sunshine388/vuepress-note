import{_ as s,W as n,X as a,Y as e,Z as p,$ as t}from"./framework-d2dfa12e.js";const o={},l=p("p",null,"手写 vue2 源码的初始环境搭建",-1),r=t(`<p>使用 Rollup 构建 Vue2 环境</p><h2 id="工程初始化" tabindex="-1"><a class="header-anchor" href="#工程初始化" aria-hidden="true">#</a> 工程初始化</h2><p>新建文件夹，执行 npm init -y 生成 package.json 文件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>npm init <span class="token operator">-</span>y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="安装-rollup-打包依赖" tabindex="-1"><a class="header-anchor" href="#安装-rollup-打包依赖" aria-hidden="true">#</a> 安装 Rollup 打包依赖</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 安装 rollup 打包用</span>
npm install rollup <span class="token operator">-</span><span class="token constant">D</span>
<span class="token comment">// 低级语法转高级语法（使用 babel 需安装@babel/core核心模块）</span>
npm install @babel<span class="token operator">/</span>core <span class="token operator">-</span><span class="token constant">D</span>
<span class="token comment">// rollup 与 babel关联</span>
npm install rollup<span class="token operator">-</span>plugin<span class="token operator">-</span>babel <span class="token operator">-</span><span class="token constant">D</span>
<span class="token comment">// 将 ES6 转译为 ES5</span>
npm install @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env <span class="token operator">-</span><span class="token constant">D</span>

<span class="token comment">// 实现 node 方式解析文件，不需要指定index</span>
npm install @rollup<span class="token operator">/</span>plugin<span class="token operator">-</span>node<span class="token operator">-</span>resolve <span class="token operator">-</span><span class="token constant">D</span>
npm install babel<span class="token operator">-</span>eslint <span class="token operator">-</span><span class="token constant">D</span>
<span class="token comment">// 设置环境变量</span>
npm install cross<span class="token operator">-</span>env <span class="token operator">-</span><span class="token constant">D</span>
<span class="token comment">// 实现静态服务</span>
npm install rollup<span class="token operator">-</span>plugin<span class="token operator">-</span>serve <span class="token operator">-</span><span class="token constant">D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="编写-vue-js-入口文件" tabindex="-1"><a class="header-anchor" href="#编写-vue-js-入口文件" aria-hidden="true">#</a> 编写 Vue.js 入口文件</h2><p>打包入口 src/index.js</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Vue<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="编写-rollup-配置文件" tabindex="-1"><a class="header-anchor" href="#编写-rollup-配置文件" aria-hidden="true">#</a> 编写 Rollup 配置文件</h2><p>创建 babel 配置文件.babelrc，创建 eslint 配置文件.eslintrc.js，创建文件 rollup.config.js</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// rollup.config.js</span>
<span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">&quot;rollup-plugin-babel&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> serve <span class="token keyword">from</span> <span class="token string">&quot;rollup-plugin-serve&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> resolve <span class="token keyword">from</span> <span class="token string">&quot;@rollup/plugin-node-resolve&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 引入插件</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 入口文件</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 支持amd 和 commonjs规范</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Vue&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&quot;dist/vue.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 输出文件</span>
    <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 使用插件</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 使用babel进行转化，但是排除node_modules文件</span>
      <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token string">&quot;node_modules/**&quot;</span><span class="token punctuation">,</span> <span class="token comment">// glob 语法；**表示任意文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// dev环境下在3000端口开启一个服务</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">ENV</span> <span class="token operator">===</span> <span class="token string">&quot;development&quot;</span>
      <span class="token operator">?</span> <span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">openPage</span><span class="token operator">:</span> <span class="token string">&quot;/pubilc/index.html&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
          <span class="token literal-property property">contentBase</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// .babelrc</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/preset-env&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// .eslintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">parser</span><span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;babel-eslint&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token number">2018</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">es6</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;flowtype&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;eslint:recommended&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;plugin:flowtype/recommended&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">__WEEX__</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">WXEnvironment</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;no-console&quot;</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&quot;production&quot;</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;no-useless-escape&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;no-empty&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="创建-rollup-script-构建脚本" tabindex="-1"><a class="header-anchor" href="#创建-rollup-script-构建脚本" aria-hidden="true">#</a> 创建 rollup-script 构建脚本</h2><p>修改 package.json 文件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env ENV=development rollup -c -w&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;build:dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup -c&quot;</span>  <span class="token comment">//-c 使用配置文件；-w 监听文件变化</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分析一下我们做了什么：</p><ol><li>使用 rollup 打包项目，入口文件是./src/index.js，出口是 dist/vue.js 及 dist/vue.js.map</li><li>使用 babel 对源码进行转义</li><li>使用 eslint</li><li>使用 cross-env 为命令行添加运行参数</li><li>使用 rollup-plugin-serve，当处于 development 环境下，在 3000 端口创建一个服务，并在默认浏览器下打开/public/index.html 页面</li><li>在/public/index.html 中引入打包好的 vue 文件 dist/vue.js</li></ol><h2 id="new-vue-options-到底做了什么" tabindex="-1"><a class="header-anchor" href="#new-vue-options-到底做了什么" aria-hidden="true">#</a> new Vue(options)到底做了什么</h2><p>Vue 其实是一个构造函数，new Vue(options)时创建了一个 Vue 实例；通过在构造函数及其 prototype 对象上添加属性/方法，实现 Vue 的功能。</p><p>Vue 实现的功能有：</p><ol><li>数据劫持</li><li>模板编译</li><li>render 函数生成 VNode；初次渲染时，直接将 VNode 转化成真实 DOM；更新时，Diff 算法，局部更新</li><li>数据响应式（Dep、Watcher 等）</li><li>keep-alive、computed、watch 等</li><li>全局 API 的实现：extend、filter 等</li></ol><h2 id="创建-html-使用-vue-js" tabindex="-1"><a class="header-anchor" href="#创建-html-使用-vue-js" aria-hidden="true">#</a> 创建 Html 使用 Vue.js</h2><p>dist 目录中创建页面入口：index.html</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;X-UA-Compatible&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;IE=edge&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Document<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;/dist/vue.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="执行构建脚本" tabindex="-1"><a class="header-anchor" href="#执行构建脚本" aria-hidden="true">#</a> 执行构建脚本</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>npm run serve
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在 dist 文件夹下生成 vue.js，vue.map.js 文件</p>`,29);function c(i,u){return n(),a("div",null,[l,e(" more "),r])}const k=s(o,[["render",c],["__file","（一）源码环境搭建.html.vue"]]);export{k as default};
